#include <CytronMotorDriver.h>
#include <Pixy2.h>
#include <Servo.h>

Pixy2 pixy;

Servo closeservo;
Servo liftservo;

int flsensor = 1;
int frsensor = 2;
int blsensor = 3;
int brsensor = 4;

int endirsensor = 0;

// motors (ONLY DEFINE ONCE)
CytronMD motorLeft(PWM_DIR, 7, 8);
CytronMD motorRight(PWM_DIR, 9, 10);

const int MAX_SPEED = 200;

// keeps speed in safe range
int clampSpeed(int s) {
  if (s > MAX_SPEED) return MAX_SPEED;
  if (s < 0) return 0;
  return s;
}

void setMotors(int leftSpeed, int rightSpeed) {
  motorLeft.setSpeed(leftSpeed);
  motorRight.setSpeed(rightSpeed);
}

void stopMotors() {
  setMotors(0, 0);
}

void forward(int speed) {
  speed = clampSpeed(speed);
  setMotors(speed, speed);
}

void turnLeft(int speed) {
  speed = clampSpeed(speed);
  setMotors(-speed, speed);
}

void turnRight(int speed) {
  speed = clampSpeed(speed);
  setMotors(speed, -speed);
}

// IR SENSOR FUNCTION
void irsensor() {

  int frontleft = digitalRead(flsensor);
  int frontright = digitalRead(frsensor);
  int backleft = digitalRead(blsensor);
  int backright = digitalRead(brsensor);

  if (frontleft == 1 && frontright == 1) {
    stopMotors();
    return;   // assignment, not comparison
  }

  else if (frontright == 0 && frontleft == 1) {
    turnLeft(100);
  }

  else if (frontright == 1 && frontleft == 0) {
    turnRight(100);
  }

  else if (frontright == 0 && frontleft == 0 && backright == 1 && backleft == 0) {
    turnRight(150);   // hard right
  }

  else if (frontright == 0 && frontleft == 0 && backright == 0 && backleft == 1) {
    turnLeft(150);    // hard left
  }

  else {
    forward(100);
  }
}

void setup() {

  Serial.begin(115200);
  pixy.init();

  closeservo.attach(9);
  liftservo.attach(8);   // missing semicolon fixed

  pinMode(flsensor, INPUT);
  pinMode(frsensor, INPUT);
  pinMode(blsensor, INPUT);
  pinMode(brsensor, INPUT);

  stopMotors();
}

void loop() {
irsensor();
pixytracker();
grabobject();
}

